source('D:/Projects/Berklee/code/main.R', echo=TRUE)
source('D:/Projects/Berklee/code/main.R', echo=TRUE)
read_excel('./data/report1567817814178.xls')
read_excel('../data/report1567817814178.xls')
devtools::install_version("readxl", version = "1.0.0")
packageVersion("readxl")
install.packages("devtools")
devtools::install_version("readxl", version = "1.0.0")
devtools::install_version("readxl", version = "1.0.0")
devtools::install_version("readxl", version = "1.0.0")
devtools::install_version("readxl", version = "1.0.0")
packageVersion(readxl)
library(readxl)
packageVersion(readxl)
packageVersion('readxl')
read_excel('../data/report1567817814178.xls')
source('D:/Projects/Berklee/code/main.R', echo=TRUE)
source('D:/Projects/Berklee/code/main.R', echo=TRUE)
source('D:/Projects/Berklee/code/main.R', echo=TRUE)
View(df)
mylm = lm('ensemble_overall ~ 1 + audition_preparedpiece + audition_improv + audition_score + scholarship_rating', df)
mylm
summary(lm)
mylm
summary(mylm)
df %>% select(contains('audition'))
colnames(df)[colnames(df).startsWith('audition')]
colnames(df)[startsWith(colnames(df), 'audition')]
startsWith(colnames(df), 'audition')
colnames(df)[startsWith(colnames(df), 'audition')] %>% paste(' = ')
colnames(df)[startsWith(colnames(df), 'audition')] %>% paste(' + ')
colnames(df)[startsWith(colnames(df), 'audition')] %>% paste0(' + ')
paste0(colnames(df)[startsWith(colnames(df), 'audition')], ' + ')
colnames(df)[startsWith(colnames(df), 'audition')] %>% paste0(' + ')
paste0(c("a", "b"), '--')
colnames(df)[startsWith(colnames(df), 'audition')] %>% paste0(collapse=' + ')
summary(df)
summary(df$`entering cohort`)
?select
source('D:/Projects/Berklee/code/main.R', echo=TRUE)
View(df)
df <- read_excel('../data/Preliminary Berklee Audition and Ensemble Data vSep6.xlsx')
select_if(df, is.character)
df %>% select(starts_with('audition')) %>% select_if(is.character)
df %>% select(starts_with('audition')) %>% select_if(is.character) %>% as.factor()
?fct_lump
df %>% select(starts_with('audition')) %>% select_if(is.character) %>% factor()
df %>% select(starts_with('audition')) %>% select_if(is.character) %>% sapply(factor)
df %>% select(starts_with('audition')) %>% select_if(is.character) %>% lapply(factor)
df %>% select(starts_with('audition')) %>% select_if(is.character) %>% apply(factor)
?apply
df %>% select(starts_with('audition')) %>% select_if(is.character) %>% sapply(factor)
df %>% select(starts_with('audition')) %>% select_if(is.character) %>% sapply(factor) %>% colnames()
aud_facs <- df %>% select(starts_with('audition')) %>% select_if(is.character) %>% sapply(factor)
df %>% select(starts_with('audition')) %>% select_if(is.character) %>% transmute(factor())
?transmute
mutate(df, audition_read2 = factor(audition_reading))
?apply
df %>% select(starts_with('audition')) %>% select_if(is.character) %>% colnames() %>% apply(FUN = function(x) {df[x] <- factor(df[x])})
df['audition_reading']
df %>% select(starts_with('audition')) %>% select_if(is.character) %>% colnames() %>% apply(FUN = function(x) {df[x] <- factor(df[[x]])})
df %>% select(starts_with('audition')) %>% select_if(is.character) %>% colnames() %>% apply(FUN = function(x) {df[[x]] <- factor(df[[x]])})
df %>% select(starts_with('audition')) %>% select_if(is.character) %>% colnames()
df %>% select(starts_with('audition')) %>% select_if(is.character) %>% colnames() %>% sapply(FUN = function(x) {df[[x]] <- factor(df[[x]])})
df %>% select(starts_with('audition')) %>% select_if(is.character) %>% colnames()
df %>% select(starts_with('audition')) %>% select_if(is.character)  %>% sapply(factor)
df %>% select(starts_with('audition')) %>% select_if(is.character)  %>% as_factor
df %>% select(starts_with('audition')) %>% select_if(is.character)  %>% as_factor()
lm('ensemble_overall ~ 1 + audition_reading', df)
lm('ensemble_overall ~ 1 + audition_reading', df)$coefficients
library(MASS)
library(readxl)
library(MASS)
library(tidyverse)
df <- read_excel('../data/report1567817814178.xlsx')
df <- read_excel('../data/Preliminary Berklee Audition and Ensemble Data vSep6.xlsx')
ol <- polr(ensemble_overall ~ 1 + audition_preparedpiece + audition_reading, df)
df$ensemble_overall <- factor(df$ensemble_overall)
ol <- polr(ensemble_overall ~ 1 + audition_preparedpiece + audition_reading, df)
summary(ol)
ol <- polr(ensemble_overall ~ 1 + audition_preparedpiece + audition_reading, df, HESS=TRUE)
ol <- polr(ensemble_overall ~ 1 + audition_preparedpiece + audition_reading, df, Hess=TRUE)
summary(ol)
colnames(select(df, starts_with('audition')))
select(df, starts_with('audition'))
dplyr::select(df, starts_with('audition'))
colnames(dplyr::select(df, starts_with('audition')))
colnames(dplyr::select(df, starts_with('audition'))) %>% paste0(collapse=' + ')
colnames(dplyr::select(df, starts_with('audition'))) %>% paste0(collapse=' + ')
colnames(dplyr::select(df, starts_with('audition'))) %>% paste0("scholarship_rating", collapse=' + ')
aud_str <- colnames(dplyr::select(df, starts_with('audition'))) %>% paste0(collapse=' + ')
ol <- polr(paste0('ensemble_overall ~ 1 + scholarship_rating', aud_str), df, Hess=TRUE)
ol <- polr(paste0('ensemble_overall ~ 1 + scholarship_rating + ', aud_str), df, Hess=TRUE)
summary(ol)
predict(ol)
df$pred <- predict(ol)
df %>% select(starts_with('audition'))
library(MASS)
library(readxl)
library(tidyverse)
# df <- read_excel('../data/report1567817814178.xlsx')
df <- read_excel('../data/Preliminary Berklee Audition and Ensemble Data vSep6.xlsx')
df %>% select(starts_with('audition'))
df %>% select(starts_with('audition')) %>% colnames()
c("1", audition_vars, "scholarship_rating")
audition_vars <- df %>% select(starts_with('audition')) %>% colnames()
c("1", audition_vars, "scholarship_rating")
paste0('ensemble_overall ~ 1 + ', audition_vars, collapse = ' + '
)
polr(paste0('ensemble_overall ~ 1 + ', paste0(audition_vars, collapse = ' + ')), df, Hess=TRUE)
df$ens_fac <- factor(df$ensemble_overall)
polr(paste0('ens_fac ~ 1 + ', paste0(audition_vars, collapse = ' + ')), df, Hess=TRUE)
df[audition_vars]
complete.cases(df[audition_vars])
!complete.cases(df[audition_vars])
df[!complete.cases(df[audition_vars]), ]
df_c <- df[!complete.cases(df[audition_vars]), ]
df_c <- df[complete.cases(df[audition_vars]), ]
polr(paste0('ens_fac ~ 1 + ', paste0(audition_vars, collapse = ' + ')), df_c, Hess=TRUE)
olm <- polr(paste0('ens_fac ~ 1 + ', paste0(audition_vars, collapse = ' + ')), df_c, Hess=TRUE)
df_c$pred <- predict(olm)
table(df_c$ens_fac, df_c$pred)
summary(factor(df$instrument))
olm <- polr(paste0('ens_fac ~ 1 + ', paste0(audition_vars, collapse = ' + ')), df_c[df_c$instrument!='VOICE (Voice)'], Hess=TRUE)
olm <- polr(paste0('ens_fac ~ 1 + ', paste0(audition_vars, collapse = ' + ')), df_c[df_c$instrument!='VOICE (Voice)', ], Hess=TRUE)
summary(olm)
df_novoice <- df_c %>% select(df_c$instrument!='VOICE (Voice)')
df_c %>% filter(df_c$instrument!='VOICE (Voice)')
NROW(df_c)
df_nc <- df_c %>% filter(df_c$instrument!='VOICE (Voice)')
olm <- polr(paste0('ens_fac ~ 1 + ', paste0(audition_vars, collapse = ' + ')), df_nv, Hess=TRUE)
olm <- polr(paste0('ens_fac ~ 1 + ', paste0(audition_vars, collapse = ' + ')), df_nc, Hess=TRUE)
summary(olm)
df_nv$pred <- predict(olm)
df_nc$pred <- predict(olm)
table(df_nc$ens_fac, df_nc$pred)
df_v <- df_c[df_c$instrument=='VOICE (Voice)']
df_v <- df_c[df_c$instrument=='VOICE (Voice)', ]
View(df_v)
model <- paste0("ens_fac ~ 1 + ", paste0(audition_vars,
collapse = " + "))
model
volm <- polr(model, df_v, Hess=TRUE)
summary(volm)
df_v$pred <- predict(volm)
table(df_v$ens_fac, df_v$pred)
trace(table(df_v$ens_fac, df_v$pred))
tr(table(df_v$ens_fac, df_v$pred))
sum(diag(table(df_v$ens_fac, df_v$pred)))
vtbl <- table(df_v$ens_fac, df_v$pred)
sum(vtbl)
acc <- function(t) {return(sum(diag(t))/sum(t))}
acc(vtbl)
summary(df_v$ens_fac - df_v$pred)
table(df_v$ens_fac, as.numeric(df_v$ens_fac))
summary(as.numeric(df_v$ens_fac) - as.numeric(df_v$pred))
summary(factor(as.numeric(df_v$ens_fac) - as.numeric(df_v$pred)))
as.numeric(df_v[, c('ens_fac', 'pred')])
as.numeric(df_v[[, c('ens_fac', 'pred')]])
df_v[[, c('ens_fac', 'pred')]]
df_v[, c('ens_fac', 'pred')]
df_v[[c('ens_fac', 'pred')]]
df_v[[, c('ens_fac', 'pred')]]
df_v[[c('ens_fac', 'pred')]]
df_v[c('ens_fac', 'pred')]
df_v[c('ens_fac', 'pred')] %>% numeric()
df_v[c('ens_fac', 'pred')] %>% as.numeric()
df_v[c('ens_fac', 'pred')] %>% mutate(as.numeric)
df_v[c('ens_fac', 'pred')]
df_v[c('ens_fac', 'pred')] %>% as.matrix
df_v[c('ens_fac', 'pred')] %>% as.matrix %>% as.numeric
df_v[c('ens_fac', 'pred')] %>% sapply(as.numeric)
as.numeric(df_c['ens_fac'])
as.numeric(df_c[['ens_fac']])
head(df_c)
getPctCorrect <-
function(df,
col_predicted = 'pred',
col_actual = 'out') {
xtab <- table(df[col_actual], df[col_predicted])
return(list(
pct_correct = sum(diag(xtab)) / sum(xtab),
deviations = (as.numeric(df[[col_predicted]]) - as.numeric(df[[col_actual]])) %>% factor %>% summary,
table = xtab
))
}
getPctCorrect(df_c)
getPctCorrect(df_c, col_actual = 'ens_fac')
df_c['ens_fac']
getPctCorrect <-
function(df,
col_predicted = 'pred',
col_actual = 'out') {
xtab <- table(df[[col_actual]], df[[col_predicted]])
return(list(
pct_correct = sum(diag(xtab)) / sum(xtab),
deviations = (as.numeric(df[[col_predicted]]) - as.numeric(df[[col_actual]])) %>% factor %>% summary,
table = xtab
))
}
getPctCorrect(df_c, col_actual = 'ens_fac')
outc <- getPctCorrect(df_c, col_actual = 'ens_fac')
outc$deviations
outc$deviations/sum(outc$deviations)
df_c <- df[complete.cases(df[audition_vars]), ]
olm <-
polr(paste0('ens_fac ~ 1 + ', paste0(audition_vars, collapse = ' + ')), df_c, Hess =
TRUE)
df_c$pred <- predict(olm)
outc <- getPctCorrect(df_c, col_actual = 'ens_fac')
outc
df_c <- df[complete.cases(df[audition_vars]), ]
olm <-
polr(paste0('ens_fac ~ 1 + scholarship_rating + ', paste0(audition_vars, collapse = ' + ')), df_c, Hess =
TRUE)
df_c$pred <- predict(olm)
outc <- getPctCorrect(df_c, col_actual = 'ens_fac')
outc
df_c[c('scholarship_rating', audition_vars)]
df_c[c('scholarship_rating', audition_vars, ens_fac)]
df_c[c('scholarship_rating', audition_vars, 'ens_fac')]
unique(df_c[c('scholarship_rating', audition_vars, 'ens_fac')])
unique(df_c[c('scholarship_rating', audition_vars)])
df_c$prob <- predict(olm, type='response')
df_c$prob <- predict(olm, type='probs')
summary(df_c$prob)
NROW(df_c$prob)
NROW(df_C)
NROW(df_c)
View(df_c)
View(df_c)
?predict
?polr
olm$lp
hist(olm$lp)
olm
polr('ens_fac ~ 1 + audition_melodic', df_c, Hess=TRUE)
polr('ens_fac ~ 1 + audition_melodiccr', df_c, Hess=TRUE)
install.packages("caret")
library(caret)
ctrl <- trainControl(method='cv', number=5)
metric <- "Accuracy"
train(ens_fac~., data=df_c)
train(ens_fac~., data=df_c, method='lda', metric=metric)
train(ens_fac~., data=df_c, method='lda', metric=metric, trControl=ctrl)
train(df_c$ens_fac~., data=df_c, method='lda', metric=metric, trControl=ctrl)
train(model, data=df_c, method='lda', metric=metric, trControl=ctrl)
x_vars
audition_vars <-
df %>% select(starts_with('audition')) %>% colnames()
x_vars <- c("1", audition_vars, "scholarship_rating")
x_vars
xv <- x_vars[-1]
sv
xv
train(x=df[xv], data=df_c, method='lda', metric=metric, trControl=ctrl)
train(x=df_c[xv], y=df_c$ens_fac, data=df_c, method='lda', metric=metric, trControl=ctrl)
train(x=df_c[xv], y=df_c$ens_fac, method='lda', metric=metric, trControl=ctrl)
library(e1071)
install.packages('e1071')
library(e1071)
train(x=df_c[xv], y=df_c$ens_fac, method='lda', metric=metric, trControl=ctrl)
warnings()
train(x=df_c[[xv]], y=df_c$ens_fac, method='lda', metric=metric, trControl=ctrl)
train(x=df_c[xv], y=df_c[ens_fac], method='lda', metric=metric, trControl=ctrl)
df_c$ensemble_overall
train(x=df_c[xv], y=df_c$ensemble_overall, method='lda', metric=metric, trControl=ctrl)
train(x=df_c[xv], y=df_c[ensemble_overall], method='lda', metric=metric, trControl=ctrl)
train(x=df_c[xv], y=df_c['ensemble_overall'], method='lda', metric=metric, trControl=ctrl)
train(x=df_c[xv], y=factor(df_c['ensemble_overall']), method='lda', metric=metric, trControl=ctrl)
train(x=df_c[xv], y=factor(df_c$ensemble_overall), method='lda', metric=metric, trControl=ctrl)
train(x=df_c[[xv]], y=factor(df_c$ensemble_overall), method='lda', metric=metric, trControl=ctrl)
train(x=df_c[[c('audition_preparedpiece')]], y=factor(df_c$ensemble_overall), method='lda', metric=metric, trControl=ctrl)
train(x=xv, y=factor(df_c$ensemble_overall), method='lda', metric=metric, trControl=ctrl)
av <- c('audition_preparedpiece', 'audition_improv', 'audition_score', 'scholarship_rating')
df[[av]]
df[av]
train(x=df_c[av], y=factor(df_c$ensemble_overall), method='lda', metric=metric, trControl=ctrl)
names(getModelInfo())
train(x=df_c[av], y=factor(df_c$ensemble_overall), method='rf', metric=metric, trControl=ctrl)
train(x=df_c[av], y=factor(df_c$ensemble_overall), method='kNN', metric=metric, trControl=ctrl)
train(x=df_c[av], y=factor(df_c$ensemble_overall), method='glm', metric=metric, trControl=ctrl)
train(x=df_c[av], y=factor(df_c$ensemble_overall), method='lda', metric=metric, trControl=ctrl)
train(x=df_c[av], y=factor(df_c$ensemble_overall), method='CART', metric=metric, trControl=ctrl)
train(x=df_c[av], y=factor(df_c$ensemble_overall), method='ctree', metric=metric, trControl=ctrl)
train(x=df_c[av], y=factor(df_c$ensemble_overall), method='svm', metric=metric, trControl=ctrl)
train(x=df_c[av], y=factor(df_c$ensemble_overall), method='lasso', metric=metric, trControl=ctrl)
df_c %>% select(is.character)
?select
df_c %>% select(is.character())
df_c
df_c %>% select(matches(is.character))
df_c %>% select_if(is.character)
charcols <- df_c %>% select_if(is.character)
charcols %>% factor()
charcols %>% mutate(factor())
charcols %>% mutate(factor
)
?mutate
mutate(charcols, as.factor)
mutate_if(charcols, as.factor)
?mutate_if
df_c %>% mutate_if(is.character, factor)
df_c <- df[complete.cases(df[audition_vars]), ] %>% mutate_if(is.character, factor)
View(df_c)
olm <-
polr(paste0('ens_fac ~ 1 + scholarship_rating + ', paste0(audition_vars, collapse = ' + ')), df_c, Hess =
TRUE)
df_c$pred <- predict(olm)
library(MASS)
library(readxl)
library(tidyverse)
# df <- read_excel('../data/report1567817814178.xlsx')
df <-
read_excel('../data/Preliminary Berklee Audition and Ensemble Data vSep6.xlsx')
audition_vars <-
df %>% select(starts_with('audition')) %>% colnames()
x_vars <- c("1", audition_vars, "scholarship_rating")
df_c <- df[complete.cases(df[audition_vars]), ] %>% mutate_if(is.character, factor)
olm <-
polr(paste0('ensemble_overall ~ 1 + scholarship_rating + ', paste0(audition_vars, collapse = ' + ')), df_c, Hess =
TRUE)
df_c$pred <- predict(olm)
library(MASS)
library(readxl)
library(tidyverse)
# df <- read_excel('../data/report1567817814178.xlsx')
df <-
read_excel('../data/Preliminary Berklee Audition and Ensemble Data vSep6.xlsx')
audition_vars <-
df %>% select(starts_with('audition')) %>% colnames()
x_vars <- c("1", audition_vars, "scholarship_rating")
df_c <- df[complete.cases(df[audition_vars]), ] %>% mutate_if(is.character, factor)
df_c
df_c$out <- factor(df_c$ensemble_overall)
source('D:/Projects/Berklee/code/main.R', echo=TRUE)
?glm
model
model <- paste0('out ~ ', paste0(x_vars, collapse=' + '))
model
model_glm <- glm(model, family=binomial(link='logit'))
library(MASS)
library(readxl)
library(tidyverse)
# df <- read_excel('../data/report1567817814178.xlsx')
df <-
read_excel('../data/Preliminary Berklee Audition and Ensemble Data vSep6.xlsx')
audition_vars <-
df %>% select(starts_with('audition')) %>% colnames()
x_vars <- c("1", audition_vars, "scholarship_rating")
model <- paste0('out ~ ', paste0(x_vars, collapse=' + '))
df_c <- df[complete.cases(df[audition_vars]), ] %>% mutate_if(is.character, factor)
df_c$out <- factor(df_c$ensemble_overall)
model_glm <- glm(model, data=df_c, family=binomial(link='logit'))
summary(model_glm)
predict(model_glm)
olm <-
polr(model, df_c, Hess = TRUE)
df_c$pred <- predict(olm)
getPctCorrect(df_c)
library(MASS)
library(readxl)
library(tidyverse)
# df <- read_excel('../data/report1567817814178.xlsx')
df <-
read_excel('../data/Preliminary Berklee Audition and Ensemble Data vSep6.xlsx')
audition_vars <-
df %>% select(starts_with('audition')) %>% colnames()
x_vars <- c("1", audition_vars, "scholarship_rating")
model <- paste0('out ~ ', paste0(x_vars, collapse=' + '))
df_c <- df[complete.cases(df[audition_vars]), ] %>% mutate_if(is.character, factor)
df_c$out <- factor(df_c$ensemble_overall)
model_glm <- glm(model, data=df_c, family=binomial(link='logit'))
predict(model_glm) %>% round()
df_c$out <- predict(model_glm) %>% round()
getPctCorrect(df_c)
df_c$out
library(MASS)
library(readxl)
library(tidyverse)
# df <- read_excel('../data/report1567817814178.xlsx')
df <-
read_excel('../data/Preliminary Berklee Audition and Ensemble Data vSep6.xlsx')
audition_vars <-
df %>% select(starts_with('audition')) %>% colnames()
x_vars <- c("1", audition_vars, "scholarship_rating")
model <- paste0('out ~ ', paste0(x_vars, collapse=' + '))
df_c <- df[complete.cases(df[audition_vars]), ] %>% mutate_if(is.character, factor)
df_c$out <- factor(df_c$ensemble_overall)
model_glm <- glm(model, data=df_c, family=binomial(link='logit'))
df_c$pred <- predict(model_glm) %>% round()
library(MASS)
library(readxl)
library(tidyverse)
# df <- read_excel('../data/report1567817814178.xlsx')
df <-
read_excel('../data/Preliminary Berklee Audition and Ensemble Data vSep6.xlsx')
audition_vars <-
df %>% select(starts_with('audition')) %>% colnames()
x_vars <- c("1", audition_vars, "scholarship_rating")
model <- paste0('out ~ ', paste0(x_vars, collapse=' + '))
df_c <- df[complete.cases(df[audition_vars]), ] %>% mutate_if(is.character, factor)
df_c$out <- factor(df_c$ensemble_overall)
model_glm <- glm(model, data=df_c, family=binomial(link='logit'))
df_c$pred <- predict(model_glm) %>% round()
getPctCorrect(df_c)
levels(df_c$out)
as.numeric(levels(df_c$out))
cbind(df_c$out, as.numeric(df_c$out))
unique(cbind(df_c$out, as.numeric(df_c$out)))
?polr
olm <-
polr(model, df_c, Hess = TRUE, method='probit')
df_c$pred <- predict(olm)
summary(df_c$pred)
df_c$prob <- predict(olm, type='probs')
df_c$prob <- predict(olm, type='score')
df_c$prob <- predict(olm, type='probs')
summary(df_c$prob)
?predict.polr
class(olm)
class(df_c$prob)
View(df_c)
plot(df_c$prob, df_c$pred)
NROW(df_c$prob)
NROW(df_c$pred)
?plot
plot(as.numeric(df_c$prob), df_c$pred)
plot(as.numeric(df_c$prob), as.numeric(df_c$pred))
df_c$prob(rm.na)
unique(df_c$prob)
unique(as.numeric(df_c$prob))
df_c$prob
df_c$prob[1]
df_c$prob[, 1]
df_c$prob[, 2]
?max
?sapply
df_c$prob
df_c$prob[1,]
max(df_c$prob[1,])
sum(df_c$prob[1,])
sapply(df_c$prob, sum)
?sum
sapply(df_c$prob, rowSums)
apply(df_c$prob, 2, sum)
apply(df_c$prob, 1, sum)
apply(df_c$prob, 1, max)
df_c$class_prob <- apply(df_c$prob, 1, max)
getPctCorrect(df_c)
getPctCorrect(df_c[df_c$class_prob > 0.5,])
getPctCorrect(df_c[df_c$class_prob > 0.8,])
getPctCorrect(df_c[df_c$class_prob > 0.6,])
getPctCorrect(df_c[df_c$class_prob > 0.5,])
getPctCorrect(df_c[df_c$class_prob > 0.2,])
getPctCorrect(df_c)
getPctCorrect(df_c[df_c$class_prob > 0.3,])
getPctCorrect(df_c[df_c$class_prob > 0.4,])
summary(df_c$class_prob)
View(df_c[df_c$class_prob > .98,])
